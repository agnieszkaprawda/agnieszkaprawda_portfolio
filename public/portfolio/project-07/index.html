<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8" />
  <title>Building Recommendation Systems for BBC iPlayer users</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  
  <meta name="author" content="StaticMania">
  
  <meta name="generator" content="Hugo 0.74.3" />

  <!-- Bootstrap -->
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <!-- font-awesome -->
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" />
  <!-- Main Stylesheets -->
  
  <link href="/scss/style.min.css" rel="stylesheet" />

  
  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
</head><body><nav class="navbar navbar-expand-lg site-navigation">
  <div class="container">
    <a class="navbar-brand" href="/">
      <img src="/images/logo.png" alt="logo" />
    </a>
    <button
      class="navbar-toggler collapsed"
      type="button"
      data-toggle="collapse"
      data-target="#sitenavbar"
    >
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>

    <div class="collapse navbar-collapse" id="sitenavbar">
      <ul class="navbar-nav ml-auto main-nav">
         
         
         
          
          <li class="nav-item">
            <a class="nav-link" href="/"
              >Home</a
            >
          </li>
           
         
          
          <li class="nav-item">
            <a class="nav-link" href="/portfolio"
              >Portfolio</a
            >
          </li>
           
         
          
          <li class="nav-item">
            <a class="nav-link" href="/blog"
              >Other Projects</a
            >
          </li>
           
         
          
          <li class="nav-item">
            <a
              class="nav-link btn btn-sm btn-primary btn-sm-rounded"
              href="/contact"
            >
              <span class="btn-area">
                <span data-text="Get in touch">
                  Get in touch
                </span>
              </span>
            </a>
          </li>
           
        
      </ul>
    </div>
  </div>
</nav>
<main>

<section class="site-project-single-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="site-project-single">
          <h1>
            Building Recommendation Systems for BBC iPlayer users
          </h1>
          <div class="site-project-single-description">
            


<style type="text/css">

.pink { background-color:#fae6e6 ; 
    border-radius: 5px; 
  padding: 20px; color: #000000;}

.blue { background-color:#DFF5F6 ; 
    border-radius: 5px; 
  padding: 20px; color: #000000;}
    
.whitep { background-color:#fffafa ;
    border: 3px gray;
    border-radius: 5px; 
  padding: 20px; color: #000000;}
    
.whiteb { background-color:#f7ffff ;
    border: 3px gray;
    border-radius: 5px; 
  padding: 20px; color: #000000;}

    
</style>
<div id="loading-the-data" class="section level4">
<h4>Loading the Data</h4>
<pre class="r blue"><code>#Loadning the needed 2 datasets
movie_data &lt;- fread(input=&quot;~/Documents/LBS/Machine Learning/Session 02/The Assignment/movies.csv&quot;,
                    stringsAsFactors = FALSE) #9742 number of rows

rating_data &lt;- fread(input = &quot;~/Documents/LBS/Machine Learning/Session 02/The Assignment/ratings.csv&quot;,nrows = 1e6) #100836 number of rows

#Creating the genre list for my data
list_genre &lt;- c(&quot;Action&quot;, &quot;Adventure&quot;, &quot;Animation&quot;, &quot;Children&quot;, 
                &quot;Comedy&quot;, &quot;Crime&quot;,&quot;Documentary&quot;, &quot;Drama&quot;, &quot;Fantasy&quot;,
                &quot;Film-Noir&quot;, &quot;Horror&quot;, &quot;Musical&quot;, &quot;Mystery&quot;,&quot;Romance&quot;,
                &quot;Sci-Fi&quot;, &quot;Thriller&quot;, &quot;War&quot;, &quot;Western&quot;)</code></pre>
</div>
<div id="cleaning-the-data" class="section level3">
<h3>Cleaning the Data</h3>
<div id="cleaning-movies-data" class="section level4">
<h4>Cleaning Movies Data</h4>
<pre class="r blue"><code>#Cleaning up the movie_data from the movies that appear more than once

#Finding the movies that appeard more than once
repeatMovies &lt;- movie_data %&gt;% 
  group_by(title) %&gt;% 
  summarise(n = n()) %&gt;% 
  filter(n &gt; 1) %&gt;% 
  pull(title)

repeatMovies # 5 movies appear more than once</code></pre>
<pre class="whiteb"><code>## [1] &quot;Confessions of a Dangerous Mind (2002)&quot;
## [2] &quot;Emma (1996)&quot;                           
## [3] &quot;Eros (2004)&quot;                           
## [4] &quot;Saturn 3 (1980)&quot;                       
## [5] &quot;War of the Worlds (2005)&quot;</code></pre>
<pre class="r blue"><code># [1] &quot;Confessions of a Dangerous Mind (2002)&quot; &quot;Emma (1996)&quot;                           
# [3] &quot;Eros (2004)&quot;                            &quot;Saturn 3 (1980)&quot;                       
# [5] &quot;War of the Worlds (2005)&quot; 

removeRows &lt;- 0  #Initialising  the variable that stores the rows we have to remove later (the duplicates)

##### REMOVE REPEATS IN RATING DATA ####

for(i in repeatMovies){
  repeatMovieLoc &lt;- which(movie_data$title == i) #Getting the indices of the rows where the current movie (with title i) is stored 
  
  tempGenre &lt;- paste(movie_data$genres[repeatMovieLoc], collapse=&quot;|&quot;)   #Collapsing the genres assigned to the duplicated movies, separated by |
  
tempGenre &lt;- paste(unique(unlist(strsplit(tempGenre, split = &quot;\\|&quot;)[[1]])), collapse = &quot;|&quot;)   #Splitting the string up again, taking only the unique values

movie_data$genres[repeatMovieLoc[1]] &lt;- tempGenre   #Bringing the new genre string to the first appearance of the movie in the dataframe
  

removeRows &lt;- c(removeRows, repeatMovieLoc[-1])  #Adding the duplicate entry (row 6271) to the list of rows I want to remove later
  
### REMOVE DUPLICATES IN RATINGS DATA ###

  
repeatMovieIdLoc &lt;- which(rating_data$movieId %in% movie_data$movieId[removeRows]) #Searching for all the entries in the rating_data dataframe that refer to duplicate movies in movie_data
  
rating_data$movieId[repeatMovieIdLoc] &lt;- movie_data$movieId[repeatMovieLoc[1]]  #Changing movieId to the movieId that remains in our movie_data dataframe
}

#Removing the duplicate rows in the movie_data
movie_data &lt;- movie_data[-removeRows,]
movie_data</code></pre>
<pre class="whiteb"><code>##       movieId                                     title
##    1:       1                          Toy Story (1995)
##    2:       2                            Jumanji (1995)
##    3:       3                   Grumpier Old Men (1995)
##    4:       4                  Waiting to Exhale (1995)
##    5:       5        Father of the Bride Part II (1995)
##   ---                                                  
## 9733:  193581 Black Butler: Book of the Atlantic (2017)
## 9734:  193583              No Game No Life: Zero (2017)
## 9735:  193585                              Flint (2017)
## 9736:  193587       Bungo Stray Dogs: Dead Apple (2018)
## 9737:  193609       Andrew Dice Clay: Dice Rules (1991)
##                                            genres
##    1: Adventure|Animation|Children|Comedy|Fantasy
##    2:                  Adventure|Children|Fantasy
##    3:                              Comedy|Romance
##    4:                        Comedy|Drama|Romance
##    5:                                      Comedy
##   ---                                            
## 9733:             Action|Animation|Comedy|Fantasy
## 9734:                    Animation|Comedy|Fantasy
## 9735:                                       Drama
## 9736:                            Action|Animation
## 9737:                                      Comedy</code></pre>
</div>
<div id="cleaning-ratings-data" class="section level4">
<h4>Cleaning Ratings Data</h4>
<p>There is a risk that the same user has rated a movie multiple times. I would like to keep only the best rating.</p>
<p>I will group by userId and movieId, and only take the highest (maximum) rating In the end, I will produce a dataframe, where there is (at most) 1 rating of a user for a movie. This is a constraint needed to build up a proper user-movie-interaction-matrix</p>
<pre class="r blue"><code>rating_data &lt;- rating_data %&gt;% 
  group_by(userId, movieId) %&gt;% 
  summarise(rating = max(rating)) %&gt;% 
  ungroup()

length(unique(rating_data$movieId)) #Identifying movies that have not been yet rated by any user. They are safe to ignore for now, since they shouldn&#39;t affect our recommendations</code></pre>
<pre class="whiteb"><code>## [1] 9719</code></pre>
<pre class="r blue"><code>length(unique(movie_data$movieId))</code></pre>
<pre class="whiteb"><code>## [1] 9737</code></pre>
<pre class="r blue"><code>setdiff(unique(movie_data$movieId), unique(rating_data$movieId)) </code></pre>
<pre class="whiteb"><code>##  [1]  1076  2939  3338  3456  4194  5721  6668  6849  7020  7792  8765 25855
## [13] 26085 30892 32160 32371 34482 85565</code></pre>
<pre class="r blue"><code>rating_data</code></pre>
<pre class="whiteb"><code>## # A tibble: 100,832 x 3
##    userId movieId rating
##     &lt;int&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1      1       1      4
##  2      1       3      4
##  3      1       6      4
##  4      1      47      5
##  5      1      50      5
##  6      1      70      3
##  7      1     101      5
##  8      1     110      4
##  9      1     151      5
## 10      1     157      5
## # … with 100,822 more rows</code></pre>
</div>
<div id="checking-the-data-is-clean" class="section level4">
<h4>Checking the Data is Clean</h4>
<pre class="r blue"><code>#movie_data
skim(movie_data)</code></pre>
<table>
<caption>(#tab:performing_data_checks)Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">movie_data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">9737</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">title</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">158</td>
<td align="right">0</td>
<td align="right">9737</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">genres</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">952</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">movieId</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">42165</td>
<td align="right">52136</td>
<td align="right">1</td>
<td align="right">3247</td>
<td align="right">7294</td>
<td align="right">76173</td>
<td align="right">193609</td>
<td align="left">▇▂▂▁▁</td>
</tr>
</tbody>
</table>
<pre class="r blue"><code>summary(movie_data)    </code></pre>
<pre class="whiteb"><code>##     movieId          title              genres         
##  Min.   :     1   Length:9737        Length:9737       
##  1st Qu.:  3247   Class :character   Class :character  
##  Median :  7294   Mode  :character   Mode  :character  
##  Mean   : 42165                                        
##  3rd Qu.: 76173                                        
##  Max.   :193609</code></pre>
<pre class="r blue"><code>head(movie_data)</code></pre>
<pre class="whiteb"><code>##    movieId                              title
## 1:       1                   Toy Story (1995)
## 2:       2                     Jumanji (1995)
## 3:       3            Grumpier Old Men (1995)
## 4:       4           Waiting to Exhale (1995)
## 5:       5 Father of the Bride Part II (1995)
## 6:       6                        Heat (1995)
##                                         genres
## 1: Adventure|Animation|Children|Comedy|Fantasy
## 2:                  Adventure|Children|Fantasy
## 3:                              Comedy|Romance
## 4:                        Comedy|Drama|Romance
## 5:                                      Comedy
## 6:                       Action|Crime|Thriller</code></pre>
<pre class="r blue"><code>#rating_data
skim(movie_data)</code></pre>
<table>
<caption>(#tab:performing_data_checks)Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">movie_data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">9737</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">title</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">158</td>
<td align="right">0</td>
<td align="right">9737</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">genres</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">952</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">movieId</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">42165</td>
<td align="right">52136</td>
<td align="right">1</td>
<td align="right">3247</td>
<td align="right">7294</td>
<td align="right">76173</td>
<td align="right">193609</td>
<td align="left">▇▂▂▁▁</td>
</tr>
</tbody>
</table>
<pre class="r blue"><code>summary(rating_data)   </code></pre>
<pre class="whiteb"><code>##      userId       movieId           rating   
##  Min.   :  1   Min.   :     1   Min.   :0.5  
##  1st Qu.:177   1st Qu.:  1199   1st Qu.:3.0  
##  Median :325   Median :  2991   Median :3.5  
##  Mean   :326   Mean   : 19430   Mean   :3.5  
##  3rd Qu.:477   3rd Qu.:  8119   3rd Qu.:4.0  
##  Max.   :610   Max.   :193609   Max.   :5.0</code></pre>
<pre class="r blue"><code>head(rating_data)</code></pre>
<pre class="whiteb"><code>## # A tibble: 6 x 3
##   userId movieId rating
##    &lt;int&gt;   &lt;int&gt;  &lt;dbl&gt;
## 1      1       1      4
## 2      1       3      4
## 3      1       6      4
## 4      1      47      5
## 5      1      50      5
## 6      1      70      3</code></pre>
<pre class="r blue"><code>dupes_movie&lt;-movie_data%&gt;%get_dupes(movieId,title) # checking for dupes once again
dupes_movie # no dupes</code></pre>
<pre class="whiteb"><code>## Empty data.table (0 rows and 4 cols): movieId,title,dupe_count,genres</code></pre>
<pre class="r blue"><code>dupes_rating&lt;-rating_data%&gt;%get_dupes(userId,movieId)
dupes_rating # no dupes</code></pre>
<pre class="whiteb"><code>## # A tibble: 0 x 4
## # … with 4 variables: userId &lt;int&gt;, movieId &lt;int&gt;, dupe_count &lt;int&gt;,
## #   rating &lt;dbl&gt;</code></pre>
<pre class="r blue"><code>movie_data</code></pre>
<pre class="whiteb"><code>##       movieId                                     title
##    1:       1                          Toy Story (1995)
##    2:       2                            Jumanji (1995)
##    3:       3                   Grumpier Old Men (1995)
##    4:       4                  Waiting to Exhale (1995)
##    5:       5        Father of the Bride Part II (1995)
##   ---                                                  
## 9733:  193581 Black Butler: Book of the Atlantic (2017)
## 9734:  193583              No Game No Life: Zero (2017)
## 9735:  193585                              Flint (2017)
## 9736:  193587       Bungo Stray Dogs: Dead Apple (2018)
## 9737:  193609       Andrew Dice Clay: Dice Rules (1991)
##                                            genres
##    1: Adventure|Animation|Children|Comedy|Fantasy
##    2:                  Adventure|Children|Fantasy
##    3:                              Comedy|Romance
##    4:                        Comedy|Drama|Romance
##    5:                                      Comedy
##   ---                                            
## 9733:             Action|Animation|Comedy|Fantasy
## 9734:                    Animation|Comedy|Fantasy
## 9735:                                       Drama
## 9736:                            Action|Animation
## 9737:                                      Comedy</code></pre>
<pre class="r blue"><code>searchMatrix &lt;- movie_data %&gt;% 
  separate_rows(genres, sep = &quot;\\|&quot;) %&gt;% #Splitting the genres assigned to movies into multiple rows
  mutate(values = 1) %&gt;% 
  pivot_wider(names_from = genres, values_from = values) %&gt;%    #Pivoting the dataframe so that each genre is assigned its own column
  replace(is.na(.), 0)

searchMatrix %&gt;%  #Some movies have no genres listed, this is not problematic for the recommendation model, since it is purely collaborative, rather than content-based
  filter(`(no genres listed)`==1) %&gt;% 
  length()</code></pre>
<pre class="whiteb"><code>## [1] 22</code></pre>
</div>
</div>
<div id="building-the-rating-matrix-user-movie-interactions-matrix" class="section level3">
<h3>Building the Rating Matrix (User-Movie-Interactions Matrix)</h3>
<pre class="r blue"><code>ratingMatrix &lt;- rating_data %&gt;% #A ratings matrix consists of userId&#39;s as rows and movieId&#39;s as columns
  arrange(movieId) %&gt;% 
  pivot_wider(names_from = movieId, values_from = rating) %&gt;%   #allocating each movie to its own column
  arrange(userId) %&gt;% 
  select(-userId)   #dropping userId


ratingMatrix &lt;- as.matrix(ratingMatrix) #converting the dataframe created above into a matrix

#Ordering the rows and columns so that those with the fewest NAs are furthest to the top left, which is crucial for selecting the most popular movies and most frequent users
ratingMatrix &lt;- ratingMatrix[order(rowSums(is.na(ratingMatrix))),order(colSums(is.na(ratingMatrix)))]


ratingMatrix &lt;- as(ratingMatrix, &quot;realRatingMatrix&quot;) #Converting the rating matrix into a recommenderlab sparse matrix</code></pre>
</div>
<div id="step-1---exploratory-analysis" class="section level1">
<h1>STEP 1 - EXPLORATORY ANALYSIS</h1>
<div id="preparing-the-data" class="section level3">
<h3>Preparing the Data</h3>
<div id="ratings-counts" class="section level4">
<h4>Ratings Counts</h4>
<pre class="r blue"><code>rating_data %&gt;% 
  group_by(rating) %&gt;% 
  summarise(n = n()) #Creating a count of movie ratings</code></pre>
<pre class="whiteb"><code>## # A tibble: 10 x 2
##    rating     n
##     &lt;dbl&gt; &lt;int&gt;
##  1    0.5  1370
##  2    1    2811
##  3    1.5  1791
##  4    2    7550
##  5    2.5  5550
##  6    3   20047
##  7    3.5 13134
##  8    4   26817
##  9    4.5  8551
## 10    5   13211</code></pre>
<pre class="r blue"><code>movie_rating_count &lt;- rating_data %&gt;% 
  group_by(movieId) %&gt;% 
  summarise(ratings = n()) %&gt;% 
  left_join(movie_data, by = &quot;movieId&quot;) %&gt;% 
  select(movieId, title, ratings) %&gt;% 
  arrange(desc(ratings)) #Creating a table with number of ratings per movie

head(movie_rating_count) #previewing </code></pre>
<pre class="whiteb"><code>## # A tibble: 6 x 3
##   movieId title                                     ratings
##     &lt;int&gt; &lt;chr&gt;                                       &lt;int&gt;
## 1     356 Forrest Gump (1994)                           329
## 2     318 Shawshank Redemption, The (1994)              317
## 3     296 Pulp Fiction (1994)                           307
## 4     593 Silence of the Lambs, The (1991)              279
## 5    2571 Matrix, The (1999)                            278
## 6     260 Star Wars: Episode IV - A New Hope (1977)     251</code></pre>
<pre class="r blue"><code>user_rating_count &lt;- rating_data %&gt;%  #Creating a table with number of ratings per user
  group_by(userId) %&gt;% 
  summarise(ratings = n()) %&gt;% 
  arrange(desc(ratings))


head(user_rating_count) #preaviewing</code></pre>
<pre class="whiteb"><code>## # A tibble: 6 x 2
##   userId ratings
##    &lt;int&gt;   &lt;int&gt;
## 1    414    2698
## 2    599    2478
## 3    474    2108
## 4    448    1864
## 5    274    1346
## 6    610    1302</code></pre>
</div>
<div id="how-similar-the-100-most-popular-movies-are-to-eachother" class="section level4">
<h4>How similar the 100 most popular movies are to eachother</h4>
<pre class="r blue"><code>movie_similarity &lt;- similarity(ratingMatrix[, 1:100], 
                               method = &quot;cosine&quot;,
                               which = &quot;items&quot;)


movie_similarity &lt;- as.matrix(movie_similarity) + diag(100) #Adding diag(100) - the similarity of a movie with itself is always 1

image(movie_similarity, main = &quot;Top 100 Popular Movies&#39; Similarity&quot;)</code></pre>
<p><img src="/portfolio/project-07_files/figure-html/similarity_100_popular_movies-1.png" width="384" style="display: block; margin: auto;" /></p>
</div>
<div id="how-similar-the-100-most-frequent-users-are-to-eachother" class="section level4">
<h4>How similar the 100 most frequent users are to eachother</h4>
<pre class="r blue"><code>#I produce a matrix which calculates how similar users are to one another
user_similarity &lt;- similarity(ratingMatrix[1:100, ],
                              method = &quot;cosine&quot;,
                              which = &quot;users&quot;)

#I also add diag(100), since the similarity of a user with themselves is 1
user_similarity &lt;- as.matrix(user_similarity) + diag(100)

image(user_similarity, main = &quot;100 Top active users&#39; similarity&quot;)</code></pre>
<p><img src="/portfolio/project-07_files/figure-html/similarity_100_frequent_users-1.png" width="384" style="display: block; margin: auto;" /></p>
</div>
<div id="a-histogram-showing-the-frequency-of-ratings-of-all-movies" class="section level4">
<h4>a Histogram Showing the Frequency of Ratings of All Movies</h4>
<pre class="r blue"><code>rating_data %&gt;% 
  group_by(rating) %&gt;% 
  count()</code></pre>
<pre class="whiteb"><code>## # A tibble: 10 x 2
## # Groups:   rating [10]
##    rating     n
##     &lt;dbl&gt; &lt;int&gt;
##  1    0.5  1370
##  2    1    2811
##  3    1.5  1791
##  4    2    7550
##  5    2.5  5550
##  6    3   20047
##  7    3.5 13134
##  8    4   26817
##  9    4.5  8551
## 10    5   13211</code></pre>
<pre class="r blue"><code>rating_data %&gt;%  #Building a histogram
  ggplot(aes(rating)) + 
  geom_bar() +
  labs(title=&quot;Movies were most frequently rated for 4.0 &quot;,subtitle = &quot;Movie rating frequency&quot;,x=&quot;Rating&quot;,y=&quot;Count&quot;) + 
  theme_minimal() + 
  theme(plot.title = element_text(color = &quot;gray60&quot;,size=15,face=&quot;bold&quot;, family= &quot;Montserrat&quot;),
        axis.title.y = element_text(size = 8, angle = 90, family=&quot;Montserrat&quot;, face = &quot;plain&quot;),
        plot.subtitle = element_text(color = &quot;gray60&quot;, face=&quot;plain&quot;, ,size= 10,family= &quot;Montserrat&quot;),
        axis.title.x = element_text(size = 8, family=&quot;Montserrat&quot;, face = &quot;plain&quot;),
        axis.text.x=element_text(family=&quot;Montserrat&quot;, size=7),
        axis.text.y=element_text(family=&quot;Montserrat&quot;, size=7))+
  scale_x_continuous(limits=c(0,5.5)) +
  scale_y_continuous(limits=c(0,30000))</code></pre>
<p><img src="/portfolio/project-07_files/figure-html/histogram_frequency_movie_ratings-1.png" width="648" style="display: block; margin: auto;" /></p>
<pre class="r blue"><code>(rating_data)</code></pre>
<pre class="whiteb"><code>## # A tibble: 100,832 x 3
##    userId movieId rating
##     &lt;int&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1      1       1      4
##  2      1       3      4
##  3      1       6      4
##  4      1      47      5
##  5      1      50      5
##  6      1      70      3
##  7      1     101      5
##  8      1     110      4
##  9      1     151      5
## 10      1     157      5
## # … with 100,822 more rows</code></pre>
</div>
</div>
</div>
<div id="step-2---select-most-common-users-and-movies" class="section level1">
<h1>STEP 2 - SELECT MOST COMMON USERS AND MOVIES</h1>
<p>I will select movies with more than ‘m’ ratings and users who have given more than ‘n’ ratings, where m &lt;- c(10, 20, 50, 100, 200); n &lt;- m</p>
<pre class="r blue"><code>#Since the rows (users) and columns (movies) of my ratingMatrix are already ranked in decreasing order of frequency/popularity, we are just slicing the matrix

#movies rated more than 10 times and users who have rated more than 10 movies
top10_rate &lt;- ratingMatrix[rowCounts(ratingMatrix) &gt; 10,colCounts(ratingMatrix) &gt; 10] 

#movies rated more than 20 times and users who have rated more than 20 movies
top20_rate &lt;- ratingMatrix[rowCounts(ratingMatrix) &gt; 20,colCounts(ratingMatrix) &gt; 20] 

#movies rated more than 50 times and users who have rated more than 50 movies
top50_rate &lt;- ratingMatrix[rowCounts(ratingMatrix) &gt; 50,colCounts(ratingMatrix) &gt; 50] 

#movies rated more than 100 times and users who have rated more than 100 movies
top100_rate &lt;- ratingMatrix[rowCounts(ratingMatrix) &gt; 100,colCounts(ratingMatrix) &gt; 100] 
#top100_rate &lt;- top100_rate[rowCounts(top100_rate) &gt; 5, ]

#movies rated more than 200 times and users who have rated more than 200 movies
top200_rate &lt;- ratingMatrix[rowCounts(ratingMatrix) &gt; 200,colCounts(ratingMatrix) &gt; 200]</code></pre>
</div>
<div id="step-3---building-recommendation-systems" class="section level1">
<h1>STEP 3 - BUILDING RECOMMENDATION SYSTEMS</h1>
<p>For building and testing my recommendation systems I built matrixes with movies containing more than m ratings and users who rated more than n movies, where n=m. I selected the following values of m &amp; n to test: 10,20,50,100, 200.
For each of the values I ran three models using methods:
- User-user memory-based method (UBCF)
- Item-item memory-based method (IBCF)
Both of the above are memory based, collaborative filtering methods that learn from the past interactions between users/items to make new recommendations. The assumption behind these is that we have a sufficient number of interaction data in order for our predictions to a) establish similarities between users/items b) predict reliable outcomes.
- Model-based approach using matrix factorisation (LIMBF)
This method is based on user-item interactions, it allows for a level of approximation for groups or individuals, we can establish a mathematical level of confidence on the model. The drawback of this approach is that it works much slower and demands much bigger computing power to execute – it is much more costly to run.</p>
<div id="splitting-each-subset-into-test-and-training-data" class="section level4">
<h4>Splitting each subset into test and training data</h4>
<pre class="r blue"><code>set.seed(1234) # setting seed
top10_split &lt;- evaluationScheme(top10_rate, method=&quot;split&quot;, train=0.8, given=-5) # splitting all the data to 80% training data and 20% remaining for the testing
top10_split</code></pre>
<pre class="whiteb"><code>## Evaluation scheme using all-but-5 items
## Method: &#39;split&#39; with 1 run(s).
## Training set proportion: 0.800
## Good ratings: NA
## Data set: 610 x 2121 rating matrix of class &#39;realRatingMatrix&#39; with 79636 ratings.</code></pre>
<pre class="r blue"><code>set.seed(1234)
top20_rate &lt;- top20_rate[rowCounts(top20_rate) &gt; 5, ]
top20_split &lt;- evaluationScheme(top20_rate, method=&quot;split&quot;, train=0.8, given=-5)
top20_split</code></pre>
<pre class="whiteb"><code>## Evaluation scheme using all-but-5 items
## Method: &#39;split&#39; with 1 run(s).
## Training set proportion: 0.800
## Good ratings: NA
## Data set: 595 x 1235 rating matrix of class &#39;realRatingMatrix&#39; with 66401 ratings.</code></pre>
<pre class="r blue"><code>set.seed(1234)
top50_split &lt;- evaluationScheme(top50_rate, method=&quot;split&quot;, train=0.8, given=-5)
top50_split</code></pre>
<pre class="whiteb"><code>## Evaluation scheme using all-but-5 items
## Method: &#39;split&#39; with 1 run(s).
## Training set proportion: 0.800
## Good ratings: NA
## Data set: 378 x 436 rating matrix of class &#39;realRatingMatrix&#39; with 36214 ratings.</code></pre>
<pre class="r blue"><code>set.seed(1234)
top100_rate &lt;- top100_rate[rowCounts(top100_rate) &gt; 5, ]
top100_split &lt;- evaluationScheme(top100_rate, method=&quot;split&quot;, train=0.8, given=-5)

set.seed(1234)
top200_rate &lt;- top200_rate[rowCounts(top200_rate) &gt; 5, ]
top200_split &lt;- evaluationScheme(top200_rate, method=&quot;split&quot;, train=0.8, given=-5)</code></pre>
<p>I will build three separate recommendations systems for each of the values of ‘n’ and ‘m’ (5 versions for each type of RS)</p>
</div>
<div id="item-based-cf" class="section level3">
<h3>Item Based CF</h3>
<pre class="r blue"><code>#TOP10
set.seed(1234) # setting seed
top10_IBCF &lt;- Recommender(getData(top10_split, &quot;train&quot;), method = &quot;IBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;,k=350))
#TOP20 
set.seed(1234) # setting seed
top20_IBCF &lt;- Recommender(getData(top20_split, &quot;train&quot;), method = &quot;IBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;,k=350))
#TOP50
set.seed(1234) # setting seed
top50_IBCF &lt;- Recommender(getData(top50_split, &quot;train&quot;), method = &quot;IBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;,k=350))
#TOP100
set.seed(1234) # setting seed
top100_IBCF &lt;- Recommender(getData(top100_split, &quot;train&quot;), method = &quot;IBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;,k=350))
#TOP200
set.seed(1234) # setting seed
top200_IBCF &lt;- Recommender(getData(top200_split, &quot;train&quot;), method = &quot;IBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;,k=350))</code></pre>
</div>
<div id="user-based-cf" class="section level3">
<h3>User Based CF</h3>
<pre class="r blue"><code>#TOP10
set.seed(1234) # setting seed
top10_UBCF &lt;- Recommender(getData(top10_split, &quot;train&quot;), method = &quot;UBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;, nn=25))
#TOP20
set.seed(1234) # setting seed
top20_UBCF &lt;- Recommender(getData(top20_split, &quot;train&quot;), method = &quot;UBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;, nn=25))
#TOP50
set.seed(1234) # setting seed
top50_UBCF &lt;- Recommender(getData(top50_split, &quot;train&quot;), method = &quot;UBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;, nn=25))
#TOP100
set.seed(1234) # setting seed
top100_UBCF &lt;- Recommender(getData(top100_split, &quot;train&quot;), method = &quot;UBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;, nn=25))
#TOP200
set.seed(1234) # setting seed
top200_UBCF &lt;- Recommender(getData(top200_split, &quot;train&quot;), method = &quot;UBCF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;, nn=25))</code></pre>
</div>
<div id="model-based-cf-using-matrix-factorisation" class="section level3">
<h3>Model Based CF using Matrix Factorisation</h3>
<pre class="r blue"><code>#TOP10
set.seed(1234) # setting seed
top10_LIBMF &lt;- Recommender(getData(top10_split, &quot;train&quot;), method = &quot;LIBMF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;))</code></pre>
<pre class="whiteb"><code>## Available parameter (with default values):
## dim   =  10
## costp_l2  =  0.01
## costq_l2  =  0.01
## nthread   =  1
## verbose   =  FALSE</code></pre>
<pre class="r blue"><code>#TOP20
set.seed(1234) # setting seed
top20_LIBMF &lt;- Recommender(getData(top20_split, &quot;train&quot;), method = &quot;LIBMF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;))</code></pre>
<pre class="whiteb"><code>## Available parameter (with default values):
## dim   =  10
## costp_l2  =  0.01
## costq_l2  =  0.01
## nthread   =  1
## verbose   =  FALSE</code></pre>
<pre class="r blue"><code>#TOP50
set.seed(1234) # setting seed
top50_LIBMF &lt;- Recommender(getData(top50_split, &quot;train&quot;), method = &quot;LIBMF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;))</code></pre>
<pre class="whiteb"><code>## Available parameter (with default values):
## dim   =  10
## costp_l2  =  0.01
## costq_l2  =  0.01
## nthread   =  1
## verbose   =  FALSE</code></pre>
<pre class="r blue"><code>#TOP100
set.seed(1234) # setting seed
top100_LIBMF &lt;- Recommender(getData(top100_split, &quot;train&quot;), method = &quot;LIBMF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;))</code></pre>
<pre class="whiteb"><code>## Available parameter (with default values):
## dim   =  10
## costp_l2  =  0.01
## costq_l2  =  0.01
## nthread   =  1
## verbose   =  FALSE</code></pre>
<pre class="r blue"><code>#TOP200
set.seed(1234) # setting seed
top200_LIBMF &lt;- Recommender(getData(top200_split, &quot;train&quot;), method = &quot;LIBMF&quot;, param=list(normalize = &quot;center&quot;, method=&quot;Cosine&quot;))</code></pre>
<pre class="whiteb"><code>## Available parameter (with default values):
## dim   =  10
## costp_l2  =  0.01
## costq_l2  =  0.01
## nthread   =  1
## verbose   =  FALSE</code></pre>
<p>In my work, I built in total 15 models. However, before I did it, I set the seed for ‘1234’ in order to split the data for each mxn matrix. It is important to mention, as one of the remarks from the analysis I realized is that the outcome and performance of the models is strongly dependent on the seed we choose. Using different seeds at the end led me to the same model choice, however, the outputs differed significantly from each other.
Let me now explain how the models behave when we include only common movies/users first. When n and m= 200, we include in our model only the movies that were rated 200 or more times and the users that rated more than 200 movies. In such a manner, we significantly shrink the data. As a result, even though the RMSE is low in comparison to other models, our dataset does not have many values and it is not fully reliable. On the contrary, when we set our n and m=10 or 20, we include also rarely watched movies and not so active users. In this way, we obtain a large dataset including the majority of the observations. However, if we include such rare items/ users, our models have much less predictive power, and that ultimately lead us to higher RMSE. As we will see further from the RMSE analysis, the best choice lies in between, when n &amp; m =100 or 50. The middle point seems to be the tradeoff of the two options mentioned above.</p>
</div>
</div>
<div id="step-4---computing-rmse-of-each-model-and-combination-of-m-x-n" class="section level1">
<h1>STEP 4 - Computing RMSE of each model and combination of m x n</h1>
<p>I will assess performance of the above models for different number of ‘items’ and ‘users’. I need to remember CF methods are most appropriate for high volume items (often watched movies) and frequent users. So, if I use n,m == 20 then performance changes as opposed to when I use n, == 50.</p>
<p>For each recommendation system we expect to see 5 RMSE numbers, corresponding to n,m == {10,20,50,100,200}</p>
<div id="rmse_item_based_cf" class="section level3">
<h3>RMSE_item_based_CF</h3>
<pre class="r blue"><code>set.seed(1234) # setting seed
#TOP10

#I compute predicted ratings by giving the model the known part of the test data (i.e. the data of the users for all but 5 movies for each user)
set.seed(1234) # setting seed
top10_IBCF_predict &lt;- predict(top10_IBCF, getData(top10_split, &quot;known&quot;), type=&quot;ratings&quot;)

#Finally, I can calculate RMSE between the predictions and the unknown part of the test data (i.e. for the 5 movies that were held out)
set.seed(1234) # setting seed
top10_IBCF_RMSE &lt;- calcPredictionAccuracy(top10_IBCF_predict, getData(top10_split, &quot;unknown&quot;))[1]
top10_IBCF_RMSE</code></pre>
<pre class="whiteb"><code>## RMSE 
## 1.12</code></pre>
<pre class="r blue"><code>#TOP20

#I compute predicted ratings by giving the model the known part of the test data (i.e. the data of the users for all but 5 movies for each user)
set.seed(1234) # setting seed
top20_IBCF_predict &lt;- predict(top20_IBCF, getData(top20_split, &quot;known&quot;), type=&quot;ratings&quot;)

#Finally, I can calculate RMSE between the predictions and the unknown part of the test data (i.e. for the 5 movies that were held out)
set.seed(1234) # setting seed
top20_IBCF_RMSE &lt;- calcPredictionAccuracy(top20_IBCF_predict, getData(top20_split, &quot;unknown&quot;))[1]
top20_IBCF_RMSE</code></pre>
<pre class="whiteb"><code>## RMSE 
## 1.05</code></pre>
<pre class="r blue"><code>#TOP20

#I compute predicted ratings by giving the model the known part of the test data (i.e. the data of the users for all but 5 movies for each user)
set.seed(1234) # setting seed
top50_IBCF_predict &lt;- predict(top50_IBCF, getData(top50_split, &quot;known&quot;), type=&quot;ratings&quot;)

#Finally, I can calculate RMSE between the predictions and the unknown part of the test data (i.e. for the 5 movies that were held out)
set.seed(1234) # setting seed
top50_IBCF_RMSE &lt;- calcPredictionAccuracy(top50_IBCF_predict, getData(top50_split, &quot;unknown&quot;))[1]
top50_IBCF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.848</code></pre>
<pre class="r blue"><code>#TOP20

#I compute predicted ratings by giving the model the known part of the test data (i.e. the data of the users for all but 5 movies for each user)
set.seed(1234) # setting seed
top100_IBCF_predict &lt;- predict(top100_IBCF, getData(top100_split, &quot;known&quot;), type=&quot;ratings&quot;)

#Finally, I can calculate RMSE between the predictions and the unknown part of the test data (i.e. for the 5 movies that were held out)
set.seed(1234) # setting seed
top100_IBCF_RMSE &lt;- calcPredictionAccuracy(top100_IBCF_predict, getData(top100_split, &quot;unknown&quot;))[1]
top100_IBCF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.823</code></pre>
<pre class="r blue"><code>#TOP200

#I compute predicted ratings by giving the model the known part of the test data (i.e. the data of the users for all but 5 movies for each user)
set.seed(1234) # setting seed
top200_IBCF_predict &lt;- predict(top200_IBCF, getData(top200_split, &quot;known&quot;), type=&quot;ratings&quot;)

#Finally, I can calculate RMSE between the predictions and the unknown part of the test data (i.e. for the 5 movies that were held out)
set.seed(1234) # setting seed
top200_IBCF_RMSE &lt;- calcPredictionAccuracy(top200_IBCF_predict, getData(top200_split, &quot;unknown&quot;))[1]
top200_IBCF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.815</code></pre>
</div>
<div id="rmse_user_based_cf" class="section level3">
<h3>RMSE_user_based_CF</h3>
<pre class="r blue"><code>set.seed(1234) # setting seed
#TOP10
top10_UBCF_predict &lt;- predict(top10_UBCF, getData(top10_split, &quot;known&quot;), type=&quot;ratings&quot;)

set.seed(1234) # setting seed
top10_UBCF_RMSE &lt;- calcPredictionAccuracy(top10_UBCF_predict, getData(top10_split, &quot;unknown&quot;))[1]
top10_UBCF_RMSE</code></pre>
<pre class="whiteb"><code>## RMSE 
## 1.15</code></pre>
<pre class="r blue"><code>#TOP20
set.seed(1234) # setting seed
top20_UBCF_predict &lt;- predict(top20_UBCF, getData(top20_split, &quot;known&quot;), type=&quot;ratings&quot;)

set.seed(1234) # setting seed
top20_UBCF_RMSE &lt;- calcPredictionAccuracy(top20_UBCF_predict, getData(top20_split, &quot;unknown&quot;))[1]
top20_UBCF_RMSE</code></pre>
<pre class="whiteb"><code>## RMSE 
## 1.24</code></pre>
<pre class="r blue"><code>#TOP50
set.seed(1234) # setting seed
top50_UBCF_predict &lt;- predict(top50_UBCF, getData(top50_split, &quot;known&quot;), type=&quot;ratings&quot;)

set.seed(1234) # setting seed
top50_UBCF_RMSE &lt;- calcPredictionAccuracy(top50_UBCF_predict, getData(top50_split, &quot;unknown&quot;))[1]
top50_UBCF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.975</code></pre>
<pre class="r blue"><code>#TOP100
set.seed(1234) # setting seed
top100_UBCF_predict &lt;- predict(top100_UBCF, getData(top100_split, &quot;known&quot;), type=&quot;ratings&quot;)

set.seed(1234) # setting seed
top100_UBCF_RMSE &lt;- calcPredictionAccuracy(top100_UBCF_predict, getData(top100_split, &quot;unknown&quot;))[1]
top100_UBCF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.868</code></pre>
<pre class="r blue"><code>#TOP200
set.seed(1234) # setting seed
top200_UBCF_predict &lt;- predict(top200_UBCF, getData(top200_split, &quot;known&quot;), type=&quot;ratings&quot;)

set.seed(1234) # setting seed
top200_UBCF_RMSE &lt;- calcPredictionAccuracy(top200_UBCF_predict, getData(top200_split, &quot;unknown&quot;))[1]
top200_UBCF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.827</code></pre>
</div>
<div id="rmse_model_based_cf_using_mf" class="section level3">
<h3>RMSE_model_based_CF_using_MF</h3>
<pre class="r blue"><code>set.seed(1234) # setting seed
#TOP10
top10_LIBMF_predict &lt;- predict(top10_LIBMF, getData(top10_split, &quot;known&quot;), type=&quot;ratings&quot;)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.1798   1.1613e+05
##    1       0.8518   6.3520e+04
##    2       0.8295   6.0723e+04
##    3       0.8056   5.7777e+04
##    4       0.7878   5.5632e+04
##    5       0.7759   5.4206e+04
##    6       0.7670   5.3179e+04
##    7       0.7604   5.2403e+04
##    8       0.7547   5.1748e+04
##    9       0.7497   5.1182e+04
##   10       0.7453   5.0694e+04
##   11       0.7411   5.0221e+04
##   12       0.7373   4.9807e+04
##   13       0.7335   4.9405e+04
##   14       0.7298   4.8997e+04
##   15       0.7261   4.8591e+04
##   16       0.7227   4.8231e+04
##   17       0.7192   4.7871e+04
##   18       0.7158   4.7514e+04
##   19       0.7124   4.7146e+04</code></pre>
<pre class="r blue"><code>set.seed(1234) # setting seed
top10_LIBMF_RMSE &lt;- calcPredictionAccuracy(top10_LIBMF_predict, getData(top10_split, &quot;unknown&quot;))[1]
top10_LIBMF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.874</code></pre>
<pre class="r blue"><code>#TOP20
set.seed(1234) # setting seed
top20_LIBMF_predict &lt;- predict(top20_LIBMF, getData(top20_split, &quot;known&quot;), type=&quot;ratings&quot;)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.1637   9.4129e+04
##    1       0.8500   5.2580e+04
##    2       0.8308   5.0597e+04
##    3       0.8094   4.8412e+04
##    4       0.7938   4.6822e+04
##    5       0.7826   4.5729e+04
##    6       0.7744   4.4932e+04
##    7       0.7685   4.4374e+04
##    8       0.7628   4.3822e+04
##    9       0.7583   4.3393e+04
##   10       0.7540   4.2986e+04
##   11       0.7501   4.2633e+04
##   12       0.7462   4.2265e+04
##   13       0.7425   4.1923e+04
##   14       0.7389   4.1610e+04
##   15       0.7355   4.1291e+04
##   16       0.7321   4.0990e+04
##   17       0.7288   4.0699e+04
##   18       0.7253   4.0381e+04
##   19       0.7221   4.0097e+04</code></pre>
<pre class="r blue"><code>set.seed(1234) # setting seed
top20_LIBMF_RMSE &lt;- calcPredictionAccuracy(top20_LIBMF_predict, getData(top20_split, &quot;unknown&quot;))[1]
top20_LIBMF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.894</code></pre>
<pre class="r blue"><code>#TOP50
set.seed(1234) # setting seed
top50_LIBMF_predict &lt;- predict(top50_LIBMF, getData(top50_split, &quot;known&quot;), type=&quot;ratings&quot;)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.1417   4.9467e+04
##    1       0.8429   2.8224e+04
##    2       0.8307   2.7527e+04
##    3       0.8154   2.6686e+04
##    4       0.7982   2.5750e+04
##    5       0.7846   2.5011e+04
##    6       0.7752   2.4517e+04
##    7       0.7683   2.4158e+04
##    8       0.7624   2.3845e+04
##    9       0.7580   2.3626e+04
##   10       0.7536   2.3398e+04
##   11       0.7500   2.3212e+04
##   12       0.7465   2.3037e+04
##   13       0.7436   2.2891e+04
##   14       0.7405   2.2732e+04
##   15       0.7377   2.2608e+04
##   16       0.7349   2.2465e+04
##   17       0.7321   2.2328e+04
##   18       0.7294   2.2192e+04
##   19       0.7268   2.2070e+04</code></pre>
<pre class="r blue"><code>set.seed(1234) # setting seed
top50_LIBMF_RMSE &lt;- calcPredictionAccuracy(top50_LIBMF_predict, getData(top50_split, &quot;unknown&quot;))[1]
top50_LIBMF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.795</code></pre>
<pre class="r blue"><code>#TOP100
set.seed(1234) # setting seed
top100_LIBMF_predict &lt;- predict(top100_LIBMF, getData(top100_split, &quot;known&quot;), type=&quot;ratings&quot;)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.1885   2.0024e+04
##    1       0.8100   9.8797e+03
##    2       0.7955   9.5802e+03
##    3       0.7718   9.1092e+03
##    4       0.7498   8.6914e+03
##    5       0.7362   8.4326e+03
##    6       0.7270   8.2630e+03
##    7       0.7217   8.1623e+03
##    8       0.7170   8.0813e+03
##    9       0.7129   8.0064e+03
##   10       0.7096   7.9432e+03
##   11       0.7067   7.8942e+03
##   12       0.7036   7.8378e+03
##   13       0.7008   7.7878e+03
##   14       0.6980   7.7401e+03
##   15       0.6954   7.6948e+03
##   16       0.6924   7.6407e+03
##   17       0.6898   7.5953e+03
##   18       0.6869   7.5460e+03
##   19       0.6844   7.5028e+03</code></pre>
<pre class="r blue"><code>set.seed(1234) # setting seed
top100_LIBMF_RMSE &lt;- calcPredictionAccuracy(top100_LIBMF_predict, getData(top100_split, &quot;unknown&quot;))[1]
top100_LIBMF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.738</code></pre>
<pre class="r blue"><code>#TOP200
set.seed(1234) # setting seed
top200_LIBMF_predict &lt;- predict(top200_LIBMF, getData(top200_split, &quot;known&quot;), type=&quot;ratings&quot;)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.6403   4.2879e+03
##    1       0.7882   1.1040e+03
##    2       0.7654   1.0478e+03
##    3       0.7472   1.0080e+03
##    4       0.7196   9.4929e+02
##    5       0.6924   8.9553e+02
##    6       0.6676   8.4433e+02
##    7       0.6521   8.1507e+02
##    8       0.6400   7.9177e+02
##    9       0.6307   7.7467e+02
##   10       0.6233   7.6104e+02
##   11       0.6168   7.4848e+02
##   12       0.6109   7.3810e+02
##   13       0.6059   7.2794e+02
##   14       0.6002   7.1799e+02
##   15       0.5951   7.0874e+02
##   16       0.5915   7.0253e+02
##   17       0.5863   6.9293e+02
##   18       0.5830   6.8768e+02
##   19       0.5777   6.7729e+02</code></pre>
<pre class="r blue"><code>set.seed(1234) # setting seed
top200_LIBMF_RMSE &lt;- calcPredictionAccuracy(top200_LIBMF_predict, getData(top200_split, &quot;unknown&quot;))[1]
top200_LIBMF_RMSE</code></pre>
<pre class="whiteb"><code>##  RMSE 
## 0.796</code></pre>
</div>
</div>
<div id="step-5---reporting-plots-showing-how-rmse-changes-given-the-model-and-values-of-n-and-m" class="section level1">
<h1>STEP 5 - REPORTING PLOTS SHOWING HOW RMSE CHANGES GIVEN THE MODEL AND VALUES OF ‘N’ AND ‘M’</h1>
<p>For each of my models, I predicted the values on the testing set and then in the next step, I checked the RMSEs for all the models. As we can observe across all the models, when n &amp; m=100, the RMSE turns out to be the lowest for each of the methods.
The Visualisation of all the RMSEs can help us better understand the performance of all the models.</p>
<pre class="r blue"><code>rmse_ibcf&lt;-c()
rmse_ubcf&lt;-c()
rmse_libmf&lt;-c()

rmse_ibcf &lt;- c(top10_IBCF_RMSE, top20_IBCF_RMSE, top50_IBCF_RMSE, top100_IBCF_RMSE, top200_IBCF_RMSE)
rmse_ubcf &lt;- c(top10_UBCF_RMSE, top20_UBCF_RMSE, top50_UBCF_RMSE, top100_UBCF_RMSE, top200_UBCF_RMSE)
rmse_libmf &lt;- c(top10_LIBMF_RMSE, top20_LIBMF_RMSE, top50_LIBMF_RMSE, top100_LIBMF_RMSE, top200_LIBMF_RMSE)

n &lt;- c(10, 20, 50, 100, 200)

models&lt;-c(&quot;IBCF&quot;,&quot;IBCF&quot;,&quot;IBCF&quot;,&quot;IBCF&quot;,&quot;IBCF&quot;,
          &quot;UBCF&quot;,&quot;UBCF&quot;,&quot;UBCF&quot;,&quot;UBCF&quot;,&quot;UBCF&quot;,
          &quot;LIBMF&quot;,&quot;LIBMF&quot;,&quot;LIBMF&quot;,&quot;LIBMF&quot;,&quot;LIBMF&quot;)

df_rmse&lt;- tibble(rmse = c(rmse_ibcf, rmse_ubcf, rmse_libmf),
                 lambda = c(n, n, n),
                 model = models)

glimpse(df_rmse)</code></pre>
<pre class="whiteb"><code>## Rows: 15
## Columns: 3
## $ rmse   &lt;dbl&gt; 1.124, 1.045, 0.848, 0.823, 0.815, 1.150, 1.241, 0.975, 0.868,…
## $ lambda &lt;dbl&gt; 10, 20, 50, 100, 200, 10, 20, 50, 100, 200, 10, 20, 50, 100, 2…
## $ model  &lt;chr&gt; &quot;IBCF&quot;, &quot;IBCF&quot;, &quot;IBCF&quot;, &quot;IBCF&quot;, &quot;IBCF&quot;, &quot;UBCF&quot;, &quot;UBCF&quot;, &quot;UBCF&quot;…</code></pre>
<pre class="r blue"><code>ggplot(df_rmse, aes(x=lambda,y=rmse,colour=model)) +
  geom_line() +
geom_point() +
  theme_minimal()+
  theme(plot.title = element_text(size=15,face=&quot;bold&quot;, family= &quot;Montserrat&quot;),
        plot.subtitle = element_text(size=10,face=&quot;plain&quot;, family= &quot;Montserrat&quot;),
        axis.title.y = element_text(size = 8, angle = 90, family=&quot;Montserrat&quot;, face = &quot;bold&quot;),
        axis.text.y=element_text(family=&quot;Montserrat&quot;, size=7),
        axis.title.x = element_text(size = 8, family=&quot;Montserrat&quot;, face = &quot;bold&quot;),
        axis.text.x=element_text(family=&quot;Montserrat&quot;, size=7))+
  labs(title = &quot;Recommendation performance works best for LIMBF model&quot;,
       subtitle = &quot;RMSEs of particular recommendations system models&quot;,
       x = &quot;n &amp; m values&quot;,
       y = &quot;RMSE&quot;,
       colour = &quot;Model&quot;) +
  
  theme(title = element_text(family=&quot;Courier&quot;, face=&quot;bold&quot;))</code></pre>
<p><img src="/portfolio/project-07_files/figure-html/unnamed-chunk-2-1.png" width="648" style="display: block; margin: auto;" /></p>
</div>
<div id="step-6---choosing-the-optimal-model-and-evaluating-its-recommendations" class="section level1">
<h1>STEP 6 - CHOOSING THE OPTIMAL MODEL AND EVALUATING ITS RECOMMENDATIONS</h1>
<p>From the above analysis, I can deduct that the best performing method and model I should choose for my recommendation system is the Matrix Factorisation Model with n &amp; m= 100.</p>
<p>Such a model is based on the interactions between users and items. It is not only dependent on one of these variables. The big advantage is as well, that such a solution does not rely on the assumption of a large historical dataset. However, in the real world, such a model might not perform well for the rare movies. For these, we should try to use perhaps a different model of different m &amp; n values and combine a mixed model that runs different analyses depending on the popularity of the movies and activeness of the users.</p>
<pre class="r blue"><code>set.seed(1234) # setting seed
#this is our recommended model
recommen_model &lt;- Recommender(getData(top100_split, &quot;train&quot;), 
                              method = &quot;LIBMF&quot;, 
                              param=list(normalize = &quot;center&quot;, 
                                         method=&quot;Cosine&quot;))</code></pre>
<pre class="whiteb"><code>## Available parameter (with default values):
## dim   =  10
## costp_l2  =  0.01
## costq_l2  =  0.01
## nthread   =  1
## verbose   =  FALSE</code></pre>
<pre class="r blue"><code>predition_LIBMF &lt;- predict(recommen_model, getData(top100_split, &quot;known&quot;), type=&quot;ratings&quot;)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.1885   2.0024e+04
##    1       0.8100   9.8797e+03
##    2       0.7955   9.5802e+03
##    3       0.7718   9.1092e+03
##    4       0.7498   8.6914e+03
##    5       0.7362   8.4326e+03
##    6       0.7270   8.2630e+03
##    7       0.7217   8.1623e+03
##    8       0.7170   8.0813e+03
##    9       0.7129   8.0064e+03
##   10       0.7096   7.9432e+03
##   11       0.7067   7.8942e+03
##   12       0.7036   7.8378e+03
##   13       0.7008   7.7878e+03
##   14       0.6980   7.7401e+03
##   15       0.6954   7.6948e+03
##   16       0.6924   7.6407e+03
##   17       0.6898   7.5953e+03
##   18       0.6869   7.5460e+03
##   19       0.6844   7.5028e+03</code></pre>
<pre class="r blue"><code>#building a matrix
prediction_2 &lt;- predict(recommen_model, top100_rate[1:25, ], type=&quot;ratings&quot;)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.1762   1.9580e+04
##    1       0.8039   9.7144e+03
##    2       0.7828   9.2965e+03
##    3       0.7584   8.8238e+03
##    4       0.7426   8.5223e+03
##    5       0.7323   8.3230e+03
##    6       0.7252   8.1958e+03
##    7       0.7206   8.1116e+03
##    8       0.7156   8.0203e+03
##    9       0.7120   7.9544e+03
##   10       0.7079   7.8818e+03
##   11       0.7046   7.8222e+03
##   12       0.7011   7.7617e+03
##   13       0.6974   7.6932e+03
##   14       0.6949   7.6527e+03
##   15       0.6911   7.5839e+03
##   16       0.6880   7.5297e+03
##   17       0.6850   7.4835e+03
##   18       0.6814   7.4205e+03
##   19       0.6785   7.3712e+03</code></pre>
<pre class="r blue"><code>as(prediction_2, &quot;matrix&quot;)[,1:10]</code></pre>
<pre class="whiteb"><code>##       356  318 296  593 2571 260  480  110  589  527
##  [1,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
##  [2,]  NA   NA  NA   NA   NA  NA   NA   NA   NA 4.01
##  [3,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
##  [4,]  NA 4.22  NA   NA   NA  NA   NA 3.77   NA 4.22
##  [5,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
##  [6,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
##  [7,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
##  [8,]  NA   NA  NA   NA   NA  NA   NA   NA   NA 4.77
##  [9,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [10,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [11,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [12,]  NA   NA  NA   NA   NA  NA   NA   NA   NA 4.22
## [13,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [14,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [15,]  NA 4.22  NA   NA   NA  NA 2.76   NA 3.27   NA
## [16,]  NA   NA  NA 3.48   NA  NA   NA   NA   NA 3.51
## [17,]  NA   NA  NA   NA   NA  NA   NA 4.00 3.73   NA
## [18,]  NA   NA  NA   NA   NA  NA   NA 3.79 3.63   NA
## [19,]  NA   NA  NA 4.35   NA  NA   NA   NA   NA   NA
## [20,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [21,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [22,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [23,]  NA   NA  NA 4.60   NA  NA   NA   NA   NA   NA
## [24,]  NA   NA  NA   NA   NA  NA   NA   NA   NA   NA
## [25,]  NA   NA  NA   NA   NA  NA 3.59   NA   NA   NA</code></pre>
<pre class="r blue"><code>#finding recommended 5 movies for user 9
top100_rate[1,]</code></pre>
<pre class="whiteb"><code>## 1 x 134 rating matrix of class &#39;realRatingMatrix&#39; with 133 ratings.</code></pre>
<pre class="r blue"><code>recommended.items.u9&lt;- predict(recommen_model, top100_rate[9,], n=5)</code></pre>
<pre class="whiteb"><code>## iter      tr_rmse          obj
##    0       1.2320   1.7357e+04
##    1       0.8243   8.2441e+03
##    2       0.8109   8.0137e+03
##    3       0.7990   7.8255e+03
##    4       0.7835   7.5721e+03
##    5       0.7702   7.3657e+03
##    6       0.7595   7.1981e+03
##    7       0.7505   7.0574e+03
##    8       0.7448   6.9676e+03
##    9       0.7384   6.8709e+03
##   10       0.7340   6.8041e+03
##   11       0.7292   6.7305e+03
##   12       0.7252   6.6733e+03
##   13       0.7213   6.6139e+03
##   14       0.7176   6.5630e+03
##   15       0.7143   6.5117e+03
##   16       0.7110   6.4643e+03
##   17       0.7076   6.4154e+03
##   18       0.7047   6.3734e+03
##   19       0.7017   6.3311e+03</code></pre>
<pre class="r blue"><code>as(recommended.items.u9, &quot;list&quot;)[[1]]</code></pre>
<pre class="whiteb"><code>## [1] &quot;4878&quot;  &quot;608&quot;   &quot;1073&quot;  &quot;1213&quot;  &quot;68954&quot;</code></pre>
<pre class="r blue"><code># [1] &quot;608&quot;  &quot;1213&quot; &quot;4878&quot; &quot;1265&quot; &quot;1197&quot; movieIDs

movies_u9&lt;- c()
movies_u9&lt;- append(movies_u9,movie_data$title[movie_data$movieId %in% &quot;608&quot;])
# &quot;Fargo (1996)&quot;

movies_u9&lt;- append(movies_u9,movie_data$title[movie_data$movieId %in% &quot;1213&quot;])
# &quot;Goodfellas (1990)&quot;

movies_u9&lt;- append(movies_u9,movie_data$title[movie_data$movieId %in% &quot;4878&quot;])
# &quot;Donnie Darko (2001)&quot;

movies_u9&lt;- append(movies_u9,movie_data$title[movie_data$movieId %in% &quot;1265&quot;])
# &quot;Groundhog Day (1993)&quot;

movies_u9&lt;- append(movies_u9,movie_data$title[movie_data$movieId %in% &quot;1197&quot;])
# &quot;Princess Bride, The (1987)&quot;

movies_u9</code></pre>
<pre class="whiteb"><code>## [1] &quot;Fargo (1996)&quot;               &quot;Goodfellas (1990)&quot;         
## [3] &quot;Donnie Darko (2001)&quot;        &quot;Groundhog Day (1993)&quot;      
## [5] &quot;Princess Bride, The (1987)&quot;</code></pre>
<p>— END —</p>
</div>

          </div>
          <div class="site-project-single-image">
            
          </div>
          
          <div class="site-project-single-action">
            <a href="/portfolio/project-13/">
              <span class="link-area">
                <span data-text="Next Project">
                  Next Project
                </span>
              </span>
              <img src="/images/to-top.svg" alt="next project">
            </a>
          </div>
          
        </div>
      </div>
    </div>
  </div>
</section>


  
  <section class="site-cta" style='background-image: url("/images/backgrounds/cta-background.jpg");'>
    <div class="container">
      <div class="row">
        <div class="col-12 text-center">
          <h1 class="site-cta-title">Contact me</h1>
          <ul class="site-cta-buttons">
            <li>
              <a href="/contact" class="btn btn-secondary">
                <span class="btn-area">
                  <span data-text="Send an email">
                    Send an email
                  </span>
                </span>
              </a>
            </li>
            <li>
              <a href="/portfolio" class="btn btn-primary">
                <span class="btn-area">
                  <span data-text="See more portfolio">
                    See more portfolio
                  </span>
                </span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>
  



        </main><footer class="site-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="site-footer-logo"><a href="/"><img src="/images/logo-footer.png" alt="logo-footer"></a></div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="site-footer-widget">
          <h5 class="site-footer-widget-title">Contact Info</h5>
          <p class="site-footer-widget-description">
            Regent's Park, London NW1 4SA
            <br>
            <a href="tel:&#43;447762727403">&#43;447762727403</a>
            <br>
            <a href="mailto:aprawda.mam2021@london.edu">aprawda.mam2021@london.edu</a>
          </p>
        </div>
      </div>
      
      
      
      <div class="col-lg-2 col-md-6">
        <div class="site-footer-widget">
          <h5 class="site-footer-widget-title">Social Media</h5>
          <ul class="site-footer-widget-links">
            
              <li><a href="https://www.linkedin.com/in/agnieszka-prawda/">Linkedin</a></li>
            
          </ul>
        </div>
      </div>
      
      
      <div class="col-lg-2 col-12">
        <a href="#top" class="site-footer-widget-top">
          <img src="/images/to-top.svg" alt="back-to-top">
          <p>
            I want to 
            <br>
            visit again
          </p>
        </a>
      </div>
    </div>
  </div>
</footer>


<script src="/js/formhandler.min.js"></script>

<script src="/js/vendor.min.js"></script>

<script src="/js/script.min.js"></script></body>
</html>
